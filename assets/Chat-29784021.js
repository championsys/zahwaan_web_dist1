import{ab as W,s as u,a4 as G,X as N,o as j,a6 as J,a as _,c as C,i as P,z as A,b as s,ac as B,d as h,t as x,n as L,ad as z,ae as X,af as Q,U as Y,a9 as Z,r as b,l as T,k as ee,F as te,j as ne,w as $,x as V,ag as oe}from"./index-43934fea.js";function se(t,l){const o=t.getBoundingClientRect();if(!l)return o.top>=0&&o.bottom<=window.innerHeight;const e=l.getBoundingClientRect();return o.top>=e.top&&o.bottom<=e.bottom}async function ae(t){return await z(),t.value instanceof HTMLElement?t.value:t.value?document.querySelector(t.value):null}function H(t){let l=`0px 0px ${t.distance}px 0px`;t.top&&(l=`${t.distance}px 0px 0px 0px`);const o=new IntersectionObserver(e=>{e[0].isIntersecting&&(t.firstload&&t.emit(),t.firstload=!0)},{root:t.parentEl,rootMargin:l});return o.observe(t.infiniteLoading.value),o}const F=(t,l)=>{const o=t.__vccOpts||t;for(const[e,d]of l)o[e]=d;return o},le={},re=t=>(X("data-v-d3e37633"),t=t(),Q(),t),ce={class:"container"},ie=re(()=>s("div",{class:"spinner"},null,-1)),ue=[ie];function de(t,l){return _(),C("div",ce,ue)}const pe=F(le,[["render",de],["__scopeId","data-v-d3e37633"]]),me={class:"state-error"},ve=W({__name:"InfiniteLoading",props:{top:{type:Boolean,default:!1},target:{},distance:{default:0},identifier:{},firstload:{type:Boolean,default:!0},slots:{}},emits:["infinite"],setup(t,{emit:l}){const o=t;let e=null,d=0;const y=u(null),c=u(""),{top:p,firstload:w,distance:k}=o,{identifier:m,target:I}=G(o),a={infiniteLoading:y,top:p,firstload:w,distance:k,parentEl:null,emit(){d=(a.parentEl||document.documentElement).scrollHeight,S.loading(),l("infinite",S)}},S={loading(){c.value="loading"},async loaded(){c.value="loaded";const r=a.parentEl||document.documentElement;await z(),p&&(r.scrollTop=r.scrollHeight-d),se(y.value,a.parentEl)&&a.emit()},complete(){c.value="complete",e==null||e.disconnect()},error(){c.value="error"}};return N(m,()=>{e==null||e.disconnect(),e=H(a)}),j(async()=>{a.parentEl=await ae(I),e=H(a)}),J(()=>{e==null||e.disconnect()}),(r,E)=>(_(),C("div",{ref_key:"infiniteLoading",ref:y,style:{"min-height":"1px"}},[P(s("div",null,[B(r.$slots,"spinner",{},()=>[h(pe)],!0)],512),[[A,c.value=="loading"]]),c.value=="complete"?B(r.$slots,"complete",{key:0},()=>{var v;return[s("span",null,x(((v=r.slots)==null?void 0:v.complete)||"No more results!"),1)]},!0):L("",!0),c.value=="error"?B(r.$slots,"error",{key:1,retry:a.emit},()=>{var v;return[s("span",me,[s("span",null,x(((v=r.slots)==null?void 0:v.error)||"Oops something went wrong!"),1),s("button",{class:"retry",onClick:E[0]||(E[0]=(...n)=>a.emit&&a.emit(...n))},"retry")])]},!0):L("",!0)],512))}}),fe=F(ve,[["__scopeId","data-v-a7077831"]]);const ge={class:"chat"},he={class:"chat-conent"},_e={class:"chat-conent-room",id:"chat-window"},ye={key:1,class:"h-100"},we={class:"h-100 d-flex align-items-center justify-content-center"},ke={class:"search-no-data-content"},be={class:"search-no-data-content-title"},Ce={class:"chat-conent-room-footer"},Me={__name:"Chat",setup(t){const{cookies:l}=Y(),o=l.get("zahwaanLoginData",{parseJSON:!0}),e=Z(),d=u(!1),y=u(!0),c=u(!1),p=u({content:""}),w=u([]),k=u([]),m=u({room:null,page:1,page_length:20}),I=()=>{const n=document.getElementById("chat-window");if(n){var i=n.scrollHeight;n.scrollTo(0,i)}},a=n=>{m.value.room=e.getUserInfo.chat_room,e.loadChatMsgs(m.value).then(()=>{var i,f;e.getChatMsgs&&((f=(i=e.getChatMsgs)==null?void 0:i.content)==null?void 0:f.length)>0&&(w.value.push(...e.getChatMsgs.content),w.value=w.value.sort(function(M,U){return new Date(U.creation)-new Date(M.creation)}),k.value=w.value.reverse(),setTimeout(()=>{c.value=!0},500),n==!0&&setTimeout(()=>{I()},500))})},S=()=>{m.value.page=m.value.page+1,a(!1)},r=()=>{e.sendChatMsg(p.value).then(()=>{p.value.content="",d.value=!1,I()})},E=n=>{n.keyCode===13&&(n.preventDefault(),r())},v=()=>{setTimeout(()=>{var n=oe.connect("https://testapp.burjalmaha.com",{transports:["websocket","polling","flashsocket"],query:`token=${o==null?void 0:o.access_token}`});return n.on("connect",function(i){var f;n.on((f=e.getUserInfo)==null?void 0:f.chat_room,M=>{k.value.push(M),setTimeout(()=>{c.value=!0},500),setTimeout(()=>{I()},500)})}),n},4e3)};return N(()=>[e.getUserInfo],()=>{e.getUserInfo&&y.value&&(a(!0),y.value=!1)},{immediate:!0,deep:!0}),j(()=>{v()}),(n,i)=>{var D;const f=b("no-data-icon"),M=b("b-form-input"),U=b("send-icon"),O=b("b-button"),q=b("b-input-group-append"),K=b("b-input-group");return _(),C("main",ge,[s("div",he,[s("div",_e,[m.value.page<((D=T(e).getChatMsgs)==null?void 0:D.total_pages)?(_(),ee(T(fe),{key:0,target:"#chat-window",onInfinite:S})):L("",!0),(_(!0),C(te,null,ne(k.value,(g,R)=>(_(),C("div",{class:"chat-conent-room-content",key:R},[s("div",{class:V(["chat-conent-room-content-message",g.sender==T(e).getUserInfo.email||g.sender_email==T(e).getUserInfo.email?"sent":"received"])},[s("p",null,x(g.content),1),s("span",null,x(n.formatDate(g.creation)),1)],2)]))),128)),k.value.length<1?(_(),C("div",ye,[s("div",we,[s("div",ke,[h(f,{class:"search-no-data-content-icon"}),s("h1",be,x(n.$t("common.There are no messages yet to contact support")),1)])])])):L("",!0)]),s("div",Ce,[h(K,{class:V(d.value?"active":"")},{default:$(()=>[h(M,{placeholder:n.$t("common.Write your message here")+"...",modelValue:p.value.content,"onUpdate:modelValue":i[0]||(i[0]=g=>p.value.content=g),onFocus:i[1]||(i[1]=g=>d.value=!0),onKeypress:E},null,8,["placeholder","modelValue"]),h(q,null,{default:$(()=>[h(O,{onClick:r},{default:$(()=>[h(U)]),_:1})]),_:1})]),_:1},8,["class"])])])])}}};export{Me as default};
